targettype     <%= build.mmp_target_type %>
target         <%= build.binary_file.basename %>

uid	       <%= build.uid2.chex_string %> <%= build.uid3.chex_string %>
secureid       <%= build.uid3.chex_string %>

<% unless build.v9_up? %>
targetpath     "\\system\\apps\\" + cl2app
<% end %>

// Stack size of 0x5000 is recommended for any but the most trivial Symbian apps
// (and in this application increasing the default would seem essential);
// running out of stack is likely to cause a KERN-EXEC 3...
// not very informative, is it.
// For Open C++ apps, the recommendation is 0x10000.
epocstacksize 	0x10000

// qmake defaults to this setting
<% if $WITH_QT %>
EPOCHEAPSIZE	0x020000 0x800000
<% end %>

<% qt_gui = false %>

systeminclude \epoc32\include
systeminclude \epoc32\include\stdapis
systeminclude \epoc32\include\stdapis\glib-2.0
<% if $WITH_QT %>
// Qt headers do refer to STL headers.
systeminclude \epoc32\include\stdapis\stlport
<% end %>

<% if $UPLOAD_WITH_CURL
   curl_dir = ($pamp_curl ? "libcurl-pamp" : "libcurl-std") %>
  <% if $pamp_curl and not $curl_as_source %>
systeminclude     \epoc32\include\curl-7.16
  <% else %>
systeminclude ..\..\..\<%= curl_dir %>\include
  <% end %>
<% end %>

<% if $WITH_QT %>
<% qt_inc_list = %w{include/QtCore include mkspecs/common/symbian/stl-off mkspecs/common/symbian}
   qt_inc_list.push('include/QtGui') if qt_gui
   for inc in qt_inc_list %>
systeminclude		../../../../../symbian-gp/qt-latest/<%= inc %>
<% end %>
<% end %>

userinclude .
userinclude ..\..\inc
userinclude ..\..\src
userinclude ..\..\..\shared
userinclude ..\..\..\lua\src
userinclude ..\..\..\lua\etc // for lua.hpp
<% if $USE_SQLITE3H %>
userinclude ..\..\..\sqlite3h\src\sqlite3
<% end %>
userinclude ..\..\..\epocxplat\src

<% if $UPLOAD_WITH_CURL %>
  <% if $pamp_curl %>
    <% if $curl_as_source %>
userinclude ..\..\..\<%= curl_dir %>\include\curl
    <% end %>
  <% else %>
userinclude ..\..\..\<%= curl_dir %>\include\curl // weird that this is required even when not building from source
  <% end %>
<% end %>

<% if $FEATURE_UPLOADER %>
userinclude ..\..\..\time-spec
<% end %>

<% if $HAVE_ANIM %>
userinclude ..\..\..\keyevents\inc
<% end %>

// Any STATICLIBRARY declarations should come before other
// stuff that is linked.

<% if $USE_SQLITE3H and ($SQLITE3H_AS == "static") %>
staticlibrary sqlite3h.lib
<% end %>

<% if $UPLOAD_WITH_CURL %>
  <% unless $curl_as_source %>
    <% if $pamp_curl %>
staticlibrary abiv2_libcurl-7_16.lib
    <% else %>
staticlibrary libcurl.lib    // built by us
    <% end %>
  <% end %>
<% end %>

// With DLLs, note that if there are symbol conflicts, it's first
// come, first served, so may want to have the more stable libraries
// listed first.

library euser.lib

<% if $DO_LOGGING %>
library flogger.lib
<% end %>

<% if $PROFILE_ENABLED %>
<% if $HAVE_PROFILEENGINE_LIB %>
library profileengine.lib
<% else %>
library profileeng.lib // SDK Plugins
<% end %>
<% end %>

<% if $SMSEVENT_ENABLED %>
library gsmu.lib // CSmsPDU
library msgs.lib // CMsvSession
library smcm.lib // CSmsClientMtm
<% end %>

library apgrfx.lib
library apparc.lib
library avkon.lib
library bafl.lib
library bluetooth.lib
library btmanclient.lib
library charconv.lib
library commdb.lib
library commonui.lib // CErrorUI
library cone.lib
library efsrv.lib
library eikcoctl.lib
library eikcore.lib
library esock.lib
library etel3rdparty.lib // CTelephony
library http.lib
library inetprotutil.lib // URI parsers
library insock.lib // Internet protocol support for esock
library lbs.lib
library ws32.lib

library aknnotify.lib eiksrv.lib // CAknGlobalNote
library cntmodel.lib // CContactDatabase
//library estor.lib // RReadStream
//library etel.lib // RCall, RLine
//library logcli.lib // CLogClient
//library pbkeng.lib // CPbkContactEngine

<% if $WEBURL_ENABLED %>
library epocxplat_e846000e.lib
<% end %>

library euserhl.lib    // High-Level APIs

library libc.lib       // PIPS
library libm.lib       // required for Lua
library libglib.lib    // Open C
library libgobject.lib // Open C
library libpthread.lib // Open C
<% if $WITH_QT %>
library libstdcpp.lib  // Open C++
<% end %>

<% if $UPLOAD_WITH_CURL %>
library libz.lib       // Open C, for Curl (be careful, there are two zlib.h files in the Symbian SDK, and both on the include path in our case)
library libssl.lib     // Open C, for Curl (maybe needed later)
library libcrypto.lib  // Open C, for Curl (maybe needed later)
<% end %>

<% if $HAVE_SQLITE3 %>
library sqlite3.lib // Qt
<% end %>

// Only static linking is supported for now, not tested with Symbian version.
<% if $USE_SQLITE3H and ($SQLITE3H_AS == "dynamic") %>
library sqlite3.lib
<% end %>

<% if $KEYPRESS_ENABLED and $HAVE_ANIM %>
library keyevents_client_2000af44.lib
<% end %>

<% if $WITH_QT %>
LIBRARY		libdl.lib
LIBRARY		QtCore.lib
<% if qt_gui %>
LIBRARY		QtGui.lib
<% end %>
<% end %>

sourcepath ..\..\src
source ac_app_context.cpp
source bb_blackboard.cpp
source cf_query.c
source cf_rcfile.cpp
<% if $IS_APPLICATION %>
source cl2appapp.cpp
source cl2appappui.cpp
source cl2appcontainer.cpp
source cl2appdocument.cpp
<% end %>
//source client-cl2.c
source client-run.c
source config_db.c
source db_creation.c
source epoc-ao-gerror.cpp
source epoc-appfocus.cpp
source epoc-btprox.cpp
source epoc-callstatus.cpp
source epoc-cellid.cpp
source epoc-cliapi-server.cpp
source epoc-gps.cpp
source epoc-iap.cpp
source epoc-inactivity.cpp
source epoc-indicator.cpp
<% if $HAVE_ANIM %>
source epoc-keypress-anim.cpp
<% else %>
source epoc-keypress.cpp
<% end %>
<% if $HAVE_PROFILEENGINE_LIB %>
source epoc-profile-31.cpp
<% else %>
source epoc-profile.cpp
<% end %>
source epoc-s60-version.cpp
source epoc-smsevent.cpp
<% if $WEBURL_ENABLED %>
source epoc-weburl.cpp
<% end %>
source er_errors.c
source er_errors_cxx.cpp
source kr_controller.c
source kr_diskspace.cpp
source kr_plat_ao_epoc.cpp
//source libluasqlite3.c // but not yet supported
<% if $FEATURE_LOCALSERVER %>
source local_server.cpp
<% end %>
source lua_bindings.cpp
source lua_cl2.cpp
//source lua_linit_cl2.c
source ld_log_db.c
source ld_create.c
source ld_logging.c
<% unless $IS_APPLICATION %>
<% if $WITH_QT %>
source main_epoc_qt.cpp
<% else %>
source main_epoc.cpp
<% end %>
<% end %>
<% if $FEATURE_REMOKON %>
source rk_jabber_session.c
source rk_remokon.c
<% end %>
source sa_array.cpp 
source sa_sensor_list_log_db.c
source sa_sensor_mark.c
//source sa_sensor_util_epoc.cpp
source symbian_auto_ptr.cpp
<% if $FEATURE_UPLOADER %>
source timer_generic_epoc.cpp
<% end %>
<% if $FEATURE_COMPRESS_LOGS %>
source ut_compress.c
<% end %>
source ut_diskspace_epoc.cpp
//source ut_immediate_epoc.cpp   //xxx experimental
//source ut_phonecall_epoc.cpp   //xxx experimental
source ut_retry_epoc.cpp
<% if $SMSEVENT_ENABLED %>
source ut_sms_epoc.cpp
<% end %>
source ut_telephony_epoc.cpp
<% if $CALLSTATUS_ENABLED or $SMSEVENT_ENABLED %>
source ut_telno_epoc.cpp
<% end %>
//source ut_timeout_epoc.cpp   //xxx experimental
<% if $FEATURE_REMOKON or $MARK_ENABLED %>
source ut_timer_epoc.cpp
<% end %>
source utils_cl2.c
source utils_cl2_cxx.cpp

<% if $FEATURE_UPLOADER %>
<% if $UPLOAD_WITH_CURL %>
source up_uploader_curl.c
<% else %>
source up_uploader_epoc.cpp
source up_poster_epoc.cpp
<% end %>
source up_shared.c
<% end %>

sourcepath ..\..\..\shared\common
source assertions_cxx.cpp
source epoc-time.cpp
source error_list.c
source gxerror.c
source gx_maybe_string.c
source logging.cpp
source logging-time.c
source platform_error.c
source utilities.c
source utilities_cxx.cpp

<% if $FEATURE_UPLOADER %>
sourcepath ..\..\..\time-spec
source moment_parser.c
source time_utils.c
<% end %>

<% if $FEATURE_REMOKON %>
userinclude ..\..\..\iksemel\include
userinclude ..\..\..\iksemel\src
sourcepath ..\..\..\iksemel\src
source base64.c
source dom.c
source filter.c
source iks.c
source ikss_stream.c
source ikst_transport_epoc.cpp
source ikstack.c
source jabber.c
source md5.c
source sax.c
source sha.c
source socketaos.cpp
source utility.c
<% end %>

sourcepath ..\..\..\lua\src
source			lapi.c
source			lauxlib.c
source			lbaselib.c
source			lcode.c
source			ldblib.c
source			ldebug.c
source			ldo.cpp       	// ldo.c compiled as C++
source			ldump.c
source			lfunc.c
source			lgc.c
source			linit.c
source			liolib.c
source			llex.c
source			lmathlib.c
source			lmem.c
source			loadlib.cpp   	// loadlib.c compiled as C++
source			lobject.c
source			lopcodes.c
source			loslib.c
source			lparser.c
source			lstate.c
source			lstring.c
source			lstrlib.c
source			ltable.c
source			ltablib.c
source			ltm.c
source			lundump.c
source			lvm.c
source 			lzio.c
source			print.c

<% if $USE_SQLITE3H and ($SQLITE3H_AS == "source") %>
sourcepath ..\..\..\sqlite3h\src\sqlite3
source alter.c
source analyze.c
source attach.c
source auth.c
source bitvec.c
source btmutex.c
source btree.c
source build.c
source callback.c
source complete.c
source date.c
source delete.c
source expr.c
source fault.c
source func.c
source global.c
source hash.c
source insert.c
source journal.c
source legacy.c
source loadext.c
source main.c
source malloc.c
source mem0.c
source mem1.c
source mem2.c
source mem3.c
source mem5.c
source memjournal.c
source mutex.c
source mutex_noop.c
//source mutex_os2.c
source mutex_unix.c
//source mutex_w32.c
source os.c
source os_symbian.c
//source os_win.c
//source os_os2.c
source pager.c
source pcache.c
source pragma.c
source prepare.c
source printf.c
source random.c
source resolve.c
source select.c
source status.c
source table.c
source tokenize.c
source trigger.c
source utf.c
source update.c
source util.c
source vacuum.c
source vdbe.c
source vdbeapi.c
source vdbeaux.c
source vdbeblob.c
source vdbefifo.c
source vdbemem.c
source vtab.c
source walker.c
source where.c
source opcodes.c
source parse.c
<% end %>

<% if $UPLOAD_WITH_CURL %>
  <% if $curl_as_source %>
// It seems that abld does not like source filename clashes (even for .c files in different directories), so we better make sure that we despite having all these files name each one uniquely.
sourcepath ..\..\..\<%= curl_dir %>\lib
SOURCE base64.c
SOURCE connect.c
SOURCE content_encoding.c
SOURCE cookie.c
<% unless $pamp_curl %>
SOURCE curl_addrinfo.c
SOURCE curl_sspi.c
<% end %>
SOURCE dict.c
SOURCE easy.c
SOURCE escape.c
//SOURCE file.c
SOURCE formdata.c
SOURCE ftp.c
SOURCE getenv.c
SOURCE getinfo.c
//SOURCE gtls.c
SOURCE hash_curl.c
//SOURCE hostares.c
SOURCE hostasyn.c
SOURCE hostip.c
SOURCE hostip4.c
SOURCE hostip6.c
SOURCE hostsyn.c
SOURCE hostthre.c
SOURCE http.c
SOURCE http_chunks.c
SOURCE http_digest.c
SOURCE http_negotiate.c
SOURCE http_ntlm.c
SOURCE if2ip.c
SOURCE inet_ntop.c
SOURCE inet_pton.c
//SOURCE krb4.c
//SOURCE krb5.c
SOURCE ldap.c
SOURCE llist.c
SOURCE md5.c
//SOURCE memdebug.c
SOURCE mprintf.c
SOURCE multi.c
SOURCE netrc.c
//SOURCE nss.c
SOURCE parsedate.c
SOURCE progress.c
//SOURCE qssl.c
<% unless $pamp_curl %>
SOURCE rawstr.c
<% end %>
SOURCE security.c
SOURCE select_curl.c
SOURCE sendf.c
SOURCE share.c
<% unless $pamp_curl %>
SOURCE slist.c
<% end %>
SOURCE socks.c
<% unless $pamp_curl %>
SOURCE socks_gssapi.c
SOURCE socks_sspi.c
<% end %>
SOURCE speedcheck.c
SOURCE splay.c
//SOURCE ssh.c
SOURCE sslgen.c
//SOURCE ssluse.c
SOURCE strdup.c
SOURCE strequal.c
SOURCE strerror.c
SOURCE strtok.c
SOURCE strtoofft.c
SOURCE telnet.c
SOURCE tftp.c
SOURCE timeval.c
SOURCE transfer.c
SOURCE url.c
SOURCE version.c

#define ENABLE_ZLIB

MACRO       BUILDING_LIBCURL

#ifdef ENABLE_ZLIB
MACRO       HAVE_LIBZ
#endif
  <% end %>
<% end %>

<% if $WITH_QT %>
// See Qt src/s60main to see what this library contains.
// Looks like it essentially just sets up cleanup stack and then calls 'main'.
// We want neither if our main_ implementation has an E32Main.
<% if qt_gui %>
//staticlibrary	qtmain.lib
<% else %>
//staticlibrary	libcrt0.lib
<% end %>
<% end %>

// This sourcepath also applies to the resource files.
sourcepath ..\..\src

LANG sc

<% if $IS_APPLICATION %>

<% if build.v9_up? %>
start resource    cl2app.rss
header
targetpath resource\apps
end //resource

start resource    cl2app_reg.rss
targetpath 	  \private\10003a3f\import\apps
end //resource
<% else %>
RESOURCE cl2app.rss
RESOURCE cl2app_caption.rss
<% end %>

<% unless build.v9_up? %>
AIF cl2app.aif ..\..\src cl2appaif.rss c8 context_pane_icon.bmp context_pane_icon_mask.bmp list_icon.bmp list_icon_mask.bmp
<% end %>

<% end %>

<% if build.v9_up? %>
VENDORID 0
<% if $CAPABILITIES.empty? %>
CAPABILITY NONE
<% else %>
CAPABILITY <%= $CAPABILITIES.join(" ") %>
<% end %>
<% end %>

<% if $KIT_VERNUM >= 52 %>
// This is required for Symbian^3 SDK, apparently.
APP_LAYER_SYSTEMINCLUDE
<% end %>

// No using the old client-server API.
macro __HIDE_IPC_V1__

macro __HAVE_APPLICATION_CONFIG__

<% if $WITH_QT %>
MACRO		UNICODE
MACRO		QT_KEYPAD_NAVIGATION
MACRO		QT_SOFTKEYS_ENABLED
MACRO		QT_USE_MATH_H_FLOATS
<% if qt_gui %>
MACRO		QT_GUI_LIB
<% end %>
MACRO		QT_CORE_LIB

OPTION CW -cwd include
OPTION ARMCC --visibility_inlines_hidden
#if defined(ARMCC_4_0)
OPTION ARMCC --import_all_vtbl
#endif

// Gives warnings for C files.
// http://bugreports.qt.nokia.com/browse/QTBUG-11629
// "To get rid of the other warning, it appears that changes are required to the makmake tool modules (specifically, cl_bpabi.pm), or the gcce.mk base file."
// This only really matters for libraries (with exports).
//OPTION GCCE -fvisibility-inlines-hidden

// http://library.forum.nokia.com/topic/S60_3rd_Edition_Cpp_Developers_Library/GUID-35228542-8C95-4849-A73F-2B4F082F0C44/html/SDL_93/doc_source/ToolsAndUtilities93/Build-ref/Mmp-ref/paged.html#Mmp-ref.paged
//PAGED

// http://library.forum.nokia.com/topic/S60_3rd_Edition_Cpp_Developers_Library/GUID-35228542-8C95-4849-A73F-2B4F082F0C44/html/SDL_93/doc_source/ToolsAndUtilities93/Build-ref/Mmp-ref/bytepaircompresstarget.html#Mmp-ref.bytepaircompresstarget
//BYTEPAIRCOMPRESSTARGET

OPTION_REPLACE ARMCC --export_all_vtbl -D__QT_NOEFFECTMACRO_DONOTUSE
<% end %>

<% if false and build.target.edition >= 3 and build.target.fp >= 1 %>
// Required for Open C++, say the Qt guys, but our code will not compile with these. Not with either S60 3.0 MR SDK or S60 3.1 SDK. Presumably the Qt guys are using the S60 3.1 SDK. And possibly it is just the Qt codebase that requires these, and not necessarily ours.
OPTION CW -wchar_t on 
MACRO _WCHAR_T_DECLARED
<% end %>
